<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <link rel="apple-touch-icon" href="images/apple-touch-icon.png" />
        <link rel="apple-touch-startup-image" media="(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2)" href="images/apple-touch-startup-image-640x1096.png">
        <meta http-equiv="Content-Security-Policy" content="default-src *; img-src 'self' data:; style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline' 'unsafe-eval'">
        <title>ACD Lecturas</title>
        <link type="text/css" rel="stylesheet" href="css/themes/default/jquery.mobile-1.4.5.css" />
        <link type="text/css" rel="stylesheet" href="style.css" />
        <link type="text/css" rel="stylesheet" href="css/colors/blue.css" />
        <link type="text/css" rel="stylesheet" href="css/swipebox.css" />
        <script type="text/javascript" src="js/jquery.min.js"></script>
        <script type="text/javascript" src="js/jquery.mobile-1.4.5.min.js"></script>
        <script type="text/javascript" src="js/jquery.swipebox.js"></script>
        <script type="text/javascript" src="js/jquery.mobile-custom.js"></script>
        <script type="text/javascript" src="cordova.js"></script>
        <script type="text/javascript" src="js/index.js"></script>
        <style type="text/css">
            .features_list li span{
                width: 15%;
                height: 20px;
            }
            .mensaje {
                background-color: orange
            }
        </style>
    </head>
    <body>
        <div data-role="page" id="contact" class="secondarypage" data-theme="b">
            <div data-role="header" data-position="fixed">
                <div class="nav_left_button"><a href="#" class="nav-toggle"><span></span></a></div>
                <div class="nav_center_logo">LECTURAS</div>
                <div class="nav_right_button"><a href="#right-panel"><img src="images/icons/white/user.png" alt="" title="" /></a></div>
                <div class="clear"></div>
            </div>

            <div role="main" class="ui-content">
                <div class="pages_maincontent">
                    <div class="tabs_content"> 
                        <div data-role="tabs" id="tabs">
                            <div data-role="navbar">
                                <ul>
                                    <li><a href="#one" class="ui-btn-active">Todas</a></li>
                                    <li><a href="#two">Completas</a></li>
                                    <li><a href="#three">Faltantes</a></li>
                                </ul>
                            </div>
                            <div id="one">
                                      
                            </div>
                            <div id="two">
                                      <h3>Tab two content</h3>
                                      
                            </div>
                            <div id="three">
                                      <h3>Tab three content</h3>
                                      
                            </div>
                        </div>
                    </div>
                </div> 
            </div>

            <div data-role="panel" id="left-panel" data-display="reveal" data-position="left">
                <nav class="main-nav">
                    <ul>
                        <li>
                            <a href="tomar_lectura.html" data-transition="slidefade"><img src="images/icons/white/team.png" alt="" title="" /><span>Scanear</span></a>
                        </li>
                        <li>
                            <a href="lecturas.html" data-transition="slidefade"><img src="images/icons/white/settings.png" alt="" title="" /><span>Lecturas</span></a>
                        </li>
                        <li>
                            <a href="sincronizar.html" data-transition="slidefade"><img src="images/icons/white/settings.png" alt="" title="" /><span>Sincronizar</span></a>
                        </li>
                    </ul>
                </nav>
            </div>

            <div data-role="panel" id="right-panel" data-display="reveal" data-position="right">
                <div class="user_login_info">
                    <div class="user_details">
                        <p>Sarah Williams</p>
                    </div>
                    <nav class="user-nav">
                        <ul>
                            <li><a href="features.html"><img src="images/icons/white/settings.png" /><span>Configuración</span></a></li>
                            <li><a href="#" onclick="app.salir()"><img src="images/icons/white/lock.png" /><span>Salir</span></a></li>
                        </ul>
                    </nav>
                </div>
                <div class="close_loginpopup_button"><a href="#" data-rel="close"><img src="images/icons/white/menu_close.png" alt="" title="" /></a></div>
            </div>
            <script type="text/javascript">

              var app = {

                db : 
                    window.openDatabase('LecturasAppDB.db', '1.0', 'LecturasAppDB', 2000000)
                ,

                iniciar : function(){
                    app.db.transaction(app.leerLecturas, app.error, app.exito);
                },

                leerLecturas : function(tx){
                    var fraccionamientos = {}, zonas = {}, medidores = {};

                    var SQLFraccionamientos = 'SELECT id, nombre FROM fraccionamientos ORDER BY id ASC;',
                    SQLZonas = 'SELECT id, fracc_id, nombre FROM zonas ORDER BY fracc_id, nombre ASC;',
                    SQLMedidores = 'SELECT * FROM lecturas ORDER BY medidor ASC;';
                  

                    tx.executeSql(SQLFraccionamientos,[], function(tx, results1){
                        var longitudA = results1.rows.length;
                        
                        for (var i = 0; i < longitudA; i++) {
                            var fracc = results1.rows.item(i);
                            fraccionamientos[ fracc.id ] = fracc.nombre;
                            zonas[ fracc.id ] = {}
                        }

                        
                        tx.executeSql(SQLZonas,[], function(tx, results2){
                            var longitudB = results2.rows.length;
                            for (var i = 0; i < longitudB; i++) {
                                var zona = results2.rows.item(i);
                                zonas[ zona.fracc_id ][ zona.id ] = zona.nombre;
                                medidores[ zona.id ] = {}
                            }

                            tx.executeSql(SQLMedidores,[], function(tx, results3){
                                console.log(results3.rows)
                                var longitudC = results3.rows.length, consecutivo = 0;
    
                                for (var i = 0; i < longitudC; i++) {
                                    var medidor = results3.rows.item(i);
                                    consecutivo++;
                                    medidores[ medidor.zona_id ][ consecutivo ] = medidor;
                                }

                                app.dibujarLecturas( fraccionamientos, zonas, medidores);
                            }, app.error);
                        
                        }, app.error);
                    
                    }, app.error);
                  
                },

                dibujarLecturas : function(fraccionamientos, zonas, medidores){
                  var one = document.getElementById('one'), cadena = '';
                  
                    for (id_fracc in fraccionamientos) {
                        cadena += '<h2 class="page_title">' + fraccionamientos[id_fracc] + '</h2>';
                        
                        for( id_zona in zonas[ id_fracc ] ){
                            var zona = zonas[ id_fracc ][ id_zona ];
                            cadena += '<h3>' + zona + '</h3>';
                            
                            cadena += '<ul class="features_list">';

                            for( consecutivo in medidores[ id_zona ] ){
                                var medidor = medidores[ id_zona ][ consecutivo ];
                                cadena += '<li style="border:1px red solid">'
                                cadena += '<span>' + medidor.medidor + '</span>'
                                cadena += '<span>' + medidor.medidor + '</span>'
                                cadena += '<span>' + medidor.medidor + '</span>'
                                cadena += '<span class="mensaje"><img src="images/icons/white/message.png"/></span>'
                                cadena += '</li>'

                            }

                            cadena += '</ul>';

                        }



                    }
                  
                  one.innerHTML = cadena;
                },

                exito : function(){
                  //alert('Lecturas leidas correctamente');
                },

                error : function(e){
                  alert('Sucedió un error. Código ' + e.code + ': '+ e.message);
                },

                salir : function(){
                    navigator.app.exitApp();
                }

            };

              document.addEventListener('deviceready', function(){
                if('addEventListener' in document){
                  app.iniciar();
                }
              }, false);
            </script>
        </div>
    </body>
</html>